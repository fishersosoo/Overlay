import{d as le,m as fe,o as de,c as he,b as A,w as $,ah as q,u as B,aa as K,t as pe,F as ve,l as z}from"./vendor.3f586db1.js";import{c as I,a as Ce}from"./_commonjsHelpers.88e99c8f.js";import"./hasOverlayPluginApi.ecf97ca4.js";import"./sweetalert2.6e640675.js";var W={exports:{}},S=1e3,E=S*60,M=E*60,R=M*24,ye=R*7,ge=R*365.25,me=function(n,r){r=r||{};var e=typeof n;if(e==="string"&&n.length>0)return we(n);if(e==="number"&&isFinite(n))return r.long?Fe(n):_e(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function we(n){if(n=String(n),!(n.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!!r){var e=parseFloat(r[1]),l=(r[2]||"ms").toLowerCase();switch(l){case"years":case"year":case"yrs":case"yr":case"y":return e*ge;case"weeks":case"week":case"w":return e*ye;case"days":case"day":case"d":return e*R;case"hours":case"hour":case"hrs":case"hr":case"h":return e*M;case"minutes":case"minute":case"mins":case"min":case"m":return e*E;case"seconds":case"second":case"secs":case"sec":case"s":return e*S;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function _e(n){var r=Math.abs(n);return r>=R?Math.round(n/R)+"d":r>=M?Math.round(n/M)+"h":r>=E?Math.round(n/E)+"m":r>=S?Math.round(n/S)+"s":n+"ms"}function Fe(n){var r=Math.abs(n);return r>=R?T(n,r,R,"day"):r>=M?T(n,r,M,"hour"):r>=E?T(n,r,E,"minute"):r>=S?T(n,r,S,"second"):n+" ms"}function T(n,r,e,l){var g=r>=e*1.5;return Math.round(n/e)+" "+l+(g?"s":"")}function be(n){e.debug=e,e.default=e,e.coerce=c,e.disable=v,e.enable=g,e.enabled=F,e.humanize=me,e.destroy=u,Object.keys(n).forEach(o=>{e[o]=n[o]}),e.names=[],e.skips=[],e.formatters={};function r(o){let i=0;for(let f=0;f<o.length;f++)i=(i<<5)-i+o.charCodeAt(f),i|=0;return e.colors[Math.abs(i)%e.colors.length]}e.selectColor=r;function e(o){let i,f=null,p,y;function d(...a){if(!d.enabled)return;const h=d,t=Number(new Date),s=t-(i||t);h.diff=s,h.prev=i,h.curr=t,i=t,a[0]=e.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");let C=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(_,b)=>{if(_==="%%")return"%";C++;const x=e.formatters[b];if(typeof x=="function"){const k=a[C];_=x.call(h,k),a.splice(C,1),C--}return _}),e.formatArgs.call(h,a),(h.log||e.log).apply(h,a)}return d.namespace=o,d.useColors=e.useColors(),d.color=e.selectColor(o),d.extend=l,d.destroy=e.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(p!==e.namespaces&&(p=e.namespaces,y=e.enabled(o)),y),set:a=>{f=a}}),typeof e.init=="function"&&e.init(d),d}function l(o,i){const f=e(this.namespace+(typeof i=="undefined"?":":i)+o);return f.log=this.log,f}function g(o){e.save(o),e.namespaces=o,e.names=[],e.skips=[];let i;const f=(typeof o=="string"?o:"").split(/[\s,]+/),p=f.length;for(i=0;i<p;i++)!f[i]||(o=f[i].replace(/\*/g,".*?"),o[0]==="-"?e.skips.push(new RegExp("^"+o.substr(1)+"$")):e.names.push(new RegExp("^"+o+"$")))}function v(){const o=[...e.names.map(m),...e.skips.map(m).map(i=>"-"+i)].join(",");return e.enable(""),o}function F(o){if(o[o.length-1]==="*")return!0;let i,f;for(i=0,f=e.skips.length;i<f;i++)if(e.skips[i].test(o))return!1;for(i=0,f=e.names.length;i<f;i++)if(e.names[i].test(o))return!0;return!1}function m(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function c(o){return o instanceof Error?o.stack||o.message:o}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var xe=be;(function(n,r){r.formatArgs=l,r.save=g,r.load=v,r.useColors=e,r.storage=F(),r.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function l(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let o=0,i=0;c[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(o++,f==="%c"&&(i=o))}),c.splice(i,0,u)}r.log=console.debug||console.log||(()=>{});function g(c){try{c?r.storage.setItem("debug",c):r.storage.removeItem("debug")}catch{}}function v(){let c;try{c=r.storage.getItem("debug")}catch{}return!c&&typeof process!="undefined"&&"env"in process&&(c={}.DEBUG),c}function F(){try{return localStorage}catch{}}n.exports=xe(r);const{formatters:m}=n.exports;m.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(W,W.exports);var ke=W.exports,Z={exports:{}};(function(n){var r=Object.prototype.hasOwnProperty,e="~";function l(){}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(e=!1));function g(c,u,o){this.fn=c,this.context=u,this.once=o||!1}function v(c,u,o,i,f){if(typeof o!="function")throw new TypeError("The listener must be a function");var p=new g(o,i||c,f),y=e?e+u:u;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],p]:c._events[y].push(p):(c._events[y]=p,c._eventsCount++),c}function F(c,u){--c._eventsCount==0?c._events=new l:delete c._events[u]}function m(){this._events=new l,this._eventsCount=0}m.prototype.eventNames=function(){var u=[],o,i;if(this._eventsCount===0)return u;for(i in o=this._events)r.call(o,i)&&u.push(e?i.slice(1):i);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(o)):u},m.prototype.listeners=function(u){var o=e?e+u:u,i=this._events[o];if(!i)return[];if(i.fn)return[i.fn];for(var f=0,p=i.length,y=new Array(p);f<p;f++)y[f]=i[f].fn;return y},m.prototype.listenerCount=function(u){var o=e?e+u:u,i=this._events[o];return i?i.fn?1:i.length:0},m.prototype.emit=function(u,o,i,f,p,y){var d=e?e+u:u;if(!this._events[d])return!1;var a=this._events[d],h=arguments.length,t,s;if(a.fn){switch(a.once&&this.removeListener(u,a.fn,void 0,!0),h){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,o),!0;case 3:return a.fn.call(a.context,o,i),!0;case 4:return a.fn.call(a.context,o,i,f),!0;case 5:return a.fn.call(a.context,o,i,f,p),!0;case 6:return a.fn.call(a.context,o,i,f,p,y),!0}for(s=1,t=new Array(h-1);s<h;s++)t[s-1]=arguments[s];a.fn.apply(a.context,t)}else{var C=a.length,w;for(s=0;s<C;s++)switch(a[s].once&&this.removeListener(u,a[s].fn,void 0,!0),h){case 1:a[s].fn.call(a[s].context);break;case 2:a[s].fn.call(a[s].context,o);break;case 3:a[s].fn.call(a[s].context,o,i);break;case 4:a[s].fn.call(a[s].context,o,i,f);break;default:if(!t)for(w=1,t=new Array(h-1);w<h;w++)t[w-1]=arguments[w];a[s].fn.apply(a[s].context,t)}}return!0},m.prototype.on=function(u,o,i){return v(this,u,o,i,!1)},m.prototype.once=function(u,o,i){return v(this,u,o,i,!0)},m.prototype.removeListener=function(u,o,i,f){var p=e?e+u:u;if(!this._events[p])return this;if(!o)return F(this,p),this;var y=this._events[p];if(y.fn)y.fn===o&&(!f||y.once)&&(!i||y.context===i)&&F(this,p);else{for(var d=0,a=[],h=y.length;d<h;d++)(y[d].fn!==o||f&&!y[d].once||i&&y[d].context!==i)&&a.push(y[d]);a.length?this._events[p]=a.length===1?a[0]:a:F(this,p)}return this},m.prototype.removeAllListeners=function(u){var o;return u?(o=e?e+u:u,this._events[o]&&F(this,o)):(this._events=new l,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=e,m.EventEmitter=m,n.exports=m})(Z);var Y=Z.exports,H=null;typeof WebSocket!="undefined"?H=WebSocket:typeof MozWebSocket!="undefined"?H=MozWebSocket:typeof I!="undefined"?H=I.WebSocket||I.MozWebSocket:typeof window!="undefined"?H=window.WebSocket||window.MozWebSocket:typeof self!="undefined"&&(H=self.WebSocket||self.MozWebSocket);var Q=H,X={exports:{}},J={exports:{}};(function(n,r){(function(e,l){n.exports=l()})(I,function(){var e=e||function(l,g){var v;if(typeof window!="undefined"&&window.crypto&&(v=window.crypto),typeof self!="undefined"&&self.crypto&&(v=self.crypto),typeof globalThis!="undefined"&&globalThis.crypto&&(v=globalThis.crypto),!v&&typeof window!="undefined"&&window.msCrypto&&(v=window.msCrypto),!v&&typeof I!="undefined"&&I.crypto&&(v=I.crypto),!v&&typeof Ce=="function")try{v=require("crypto")}catch{}var F=function(){if(v){if(typeof v.getRandomValues=="function")try{return v.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof v.randomBytes=="function")try{return v.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function t(){}return function(s){var C;return t.prototype=s,C=new t,t.prototype=null,C}}(),c={},u=c.lib={},o=u.Base=function(){return{extend:function(t){var s=m(this);return t&&s.mixIn(t),(!s.hasOwnProperty("init")||this.init===s.init)&&(s.init=function(){s.$super.init.apply(this,arguments)}),s.init.prototype=s,s.$super=this,s},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var s in t)t.hasOwnProperty(s)&&(this[s]=t[s]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=u.WordArray=o.extend({init:function(t,s){t=this.words=t||[],s!=g?this.sigBytes=s:this.sigBytes=t.length*4},toString:function(t){return(t||p).stringify(this)},concat:function(t){var s=this.words,C=t.words,w=this.sigBytes,_=t.sigBytes;if(this.clamp(),w%4)for(var b=0;b<_;b++){var x=C[b>>>2]>>>24-b%4*8&255;s[w+b>>>2]|=x<<24-(w+b)%4*8}else for(var k=0;k<_;k+=4)s[w+k>>>2]=C[k>>>2];return this.sigBytes+=_,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=l.ceil(s/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var s=[],C=0;C<t;C+=4)s.push(F());return new i.init(s,t)}}),f=c.enc={},p=f.Hex={stringify:function(t){for(var s=t.words,C=t.sigBytes,w=[],_=0;_<C;_++){var b=s[_>>>2]>>>24-_%4*8&255;w.push((b>>>4).toString(16)),w.push((b&15).toString(16))}return w.join("")},parse:function(t){for(var s=t.length,C=[],w=0;w<s;w+=2)C[w>>>3]|=parseInt(t.substr(w,2),16)<<24-w%8*4;return new i.init(C,s/2)}},y=f.Latin1={stringify:function(t){for(var s=t.words,C=t.sigBytes,w=[],_=0;_<C;_++){var b=s[_>>>2]>>>24-_%4*8&255;w.push(String.fromCharCode(b))}return w.join("")},parse:function(t){for(var s=t.length,C=[],w=0;w<s;w++)C[w>>>2]|=(t.charCodeAt(w)&255)<<24-w%4*8;return new i.init(C,s)}},d=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(y.stringify(t)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(t){return y.parse(unescape(encodeURIComponent(t)))}},a=u.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(t){typeof t=="string"&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var s,C=this._data,w=C.words,_=C.sigBytes,b=this.blockSize,x=b*4,k=_/x;t?k=l.ceil(k):k=l.max((k|0)-this._minBufferSize,0);var O=k*b,P=l.min(O*4,_);if(O){for(var D=0;D<O;D+=b)this._doProcessBlock(w,D);s=w.splice(0,O),C.sigBytes-=P}return new i.init(s,P)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});u.Hasher=a.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){a.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var s=this._doFinalize();return s},blockSize:512/32,_createHelper:function(t){return function(s,C){return new t.init(C).finalize(s)}},_createHmacHelper:function(t){return function(s,C){return new h.HMAC.init(t,C).finalize(s)}}});var h=c.algo={};return c}(Math);return e})})(J);(function(n,r){(function(e,l){n.exports=l(J.exports)})(I,function(e){return function(l){var g=e,v=g.lib,F=v.WordArray,m=v.Hasher,c=g.algo,u=[],o=[];(function(){function p(h){for(var t=l.sqrt(h),s=2;s<=t;s++)if(!(h%s))return!1;return!0}function y(h){return(h-(h|0))*4294967296|0}for(var d=2,a=0;a<64;)p(d)&&(a<8&&(u[a]=y(l.pow(d,1/2))),o[a]=y(l.pow(d,1/3)),a++),d++})();var i=[],f=c.SHA256=m.extend({_doReset:function(){this._hash=new F.init(u.slice(0))},_doProcessBlock:function(p,y){for(var d=this._hash.words,a=d[0],h=d[1],t=d[2],s=d[3],C=d[4],w=d[5],_=d[6],b=d[7],x=0;x<64;x++){if(x<16)i[x]=p[y+x]|0;else{var k=i[x-15],O=(k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3,P=i[x-2],D=(P<<15|P>>>17)^(P<<13|P>>>19)^P>>>10;i[x]=O+i[x-7]+D+i[x-16]}var oe=C&w^~C&_,ie=a&h^a&t^h&t,ae=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),ce=(C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25),G=b+ce+oe+o[x]+i[x],ue=ae+ie;b=_,_=w,w=C,C=s+G|0,s=t,t=h,h=a,a=G+ue|0}d[0]=d[0]+a|0,d[1]=d[1]+h|0,d[2]=d[2]+t|0,d[3]=d[3]+s|0,d[4]=d[4]+C|0,d[5]=d[5]+w|0,d[6]=d[6]+_|0,d[7]=d[7]+b|0},_doFinalize:function(){var p=this._data,y=p.words,d=this._nDataBytes*8,a=p.sigBytes*8;return y[a>>>5]|=128<<24-a%32,y[(a+64>>>9<<4)+14]=l.floor(d/4294967296),y[(a+64>>>9<<4)+15]=d,p.sigBytes=y.length*4,this._process(),this._hash},clone:function(){var p=m.clone.call(this);return p._hash=this._hash.clone(),p}});g.SHA256=m._createHelper(f),g.HmacSHA256=m._createHmacHelper(f)}(Math),e.SHA256})})(X);var ee=X.exports,te={exports:{}};(function(n,r){(function(e,l){n.exports=l(J.exports)})(I,function(e){return function(){var l=e,g=l.lib,v=g.WordArray,F=l.enc;F.Base64={stringify:function(c){var u=c.words,o=c.sigBytes,i=this._map;c.clamp();for(var f=[],p=0;p<o;p+=3)for(var y=u[p>>>2]>>>24-p%4*8&255,d=u[p+1>>>2]>>>24-(p+1)%4*8&255,a=u[p+2>>>2]>>>24-(p+2)%4*8&255,h=y<<16|d<<8|a,t=0;t<4&&p+t*.75<o;t++)f.push(i.charAt(h>>>6*(3-t)&63));var s=i.charAt(64);if(s)for(;f.length%4;)f.push(s);return f.join("")},parse:function(c){var u=c.length,o=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var f=0;f<o.length;f++)i[o.charCodeAt(f)]=f}var p=o.charAt(64);if(p){var y=c.indexOf(p);y!==-1&&(u=y)}return m(c,u,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function m(c,u,o){for(var i=[],f=0,p=0;p<u;p++)if(p%4){var y=o[c.charCodeAt(p-1)]<<p%4*2,d=o[c.charCodeAt(p)]>>>6-p%4*2,a=y|d;i[f>>>2]|=a<<24-f%4*8,f++}return v.create(i,f)}}(),e.enc.Base64})})(te);var ne=te.exports;function U(){return U=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},U.apply(this,arguments)}function Ae(n,r){if(n==null)return{};var e={},l=Object.keys(n),g,v;for(v=0;v<l.length;v++)g=l[v],!(r.indexOf(g)>=0)&&(e[g]=n[g]);return e}var L;(function(n){n[n.Hello=0]="Hello",n[n.Identify=1]="Identify",n[n.Identified=2]="Identified",n[n.Reidentify=3]="Reidentify",n[n.Event=5]="Event",n[n.Request=6]="Request",n[n.RequestResponse=7]="RequestResponse",n[n.RequestBatch=8]="RequestBatch",n[n.RequestBatchResponse=9]="RequestBatchResponse"})(L||(L={}));var re;(function(n){n[n.None=0]="None",n[n.General=1]="General",n[n.Config=2]="Config",n[n.Scenes=4]="Scenes",n[n.Inputs=8]="Inputs",n[n.Transitions=16]="Transitions",n[n.Filters=32]="Filters",n[n.Outputs=64]="Outputs",n[n.SceneItems=128]="SceneItems",n[n.MediaInputs=256]="MediaInputs",n[n.Vendors=512]="Vendors",n[n.Ui=1024]="Ui",n[n.All=1023]="All",n[n.InputVolumeMeters=65536]="InputVolumeMeters",n[n.InputActiveStateChanged=131072]="InputActiveStateChanged",n[n.InputShowStateChanged=262144]="InputShowStateChanged",n[n.SceneItemTransformChanged=524288]="SceneItemTransformChanged"})(re||(re={}));var se;(function(n){n[n.None=-1]="None",n[n.SerialRealtime=0]="SerialRealtime",n[n.SerialFrame=1]="SerialFrame",n[n.Parallel=2]="Parallel"})(se||(se={}));function Be(n,r,e){const l=ne.stringify(ee(e+n));return ne.stringify(ee(l+r))}const Le=["authentication","rpcVersion"],j=ke("obs-websocket-js");class N extends Error{constructor(r,e){super(e);this.code=void 0,this.code=r}}class V extends Y{constructor(...r){super(...r);this._identified=!1,this.internalListeners=new Y,this.socket=void 0}static generateMessageId(){return String(V.requestCounter++)}get identified(){return this._identified}async connect(r="ws://127.0.0.1:4455",e,l={}){var g=this;this.socket&&await this.disconnect();try{const v=this.internalEventPromise("ConnectionClosed"),F=this.internalEventPromise("ConnectionError");return await Promise.race([async function(){const m=await g.createConnection(r);return g.emit("Hello",m),g.identify(m,e,l)}(),new Promise((m,c)=>{F.then(u=>{u.message&&c(u)}),v.then(u=>{c(u)})})])}catch(v){throw await this.disconnect(),v}}async disconnect(){if(!this.socket||this.socket.readyState===Q.CLOSED)return;const r=this.internalEventPromise("ConnectionClosed");this.socket.close(),await r}async reidentify(r){const e=this.internalEventPromise(`op:${L.Identified}`);return await this.message(L.Reidentify,r),e}async call(r,e){const l=V.generateMessageId(),g=this.internalEventPromise(`res:${l}`);await this.message(L.Request,{requestId:l,requestType:r,requestData:e});const{requestStatus:v,responseData:F}=await g;if(!v.result)throw new N(v.code,v.comment);return F}cleanup(){!this.socket||(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(r){var e;const l=this.internalEventPromise("ConnectionOpened"),g=this.internalEventPromise(`op:${L.Hello}`);this.socket=new Q(r,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await l;const v=(e=this.socket)==null?void 0:e.protocol;if(!v)throw new N(-1,"Server sent no subprotocol");if(v!==this.protocol)throw new N(-1,"Server sent an invalid subprotocol");return g}async identify(r,e,l={}){let{authentication:g,rpcVersion:v}=r,F=Ae(r,Le);const m=U({rpcVersion:v},l);g&&e&&(m.authentication=Be(g.salt,g.challenge,e));const c=this.internalEventPromise(`op:${L.Identified}`);await this.message(L.Identify,m);const u=await c;return this._identified=!0,this.emit("Identified",u),U({rpcVersion:v},F,u)}async message(r,e){if(!this.socket)throw new Error("Not connected");if(!this.identified&&r!==1)throw new Error("Socket not identified");const l=await this.encodeMessage({op:r,d:e});this.socket.send(l)}async internalEventPromise(r){return new Promise(e=>{this.internalListeners.once(r,e)})}onOpen(r){j("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",r)}async onMessage(r){try{const{op:e,d:l}=await this.decodeMessage(r.data);if(j("socket.message: %d %j",e,l),e===void 0||l===void 0)return;switch(e){case L.Event:{const{eventType:g,eventData:v}=l;this.emit(g,v);return}case L.RequestResponse:{const{requestId:g}=l;this.internalListeners.emit(`res:${g}`,l);return}default:this.internalListeners.emit(`op:${e}`,l)}}catch(e){j("error handling message: %o",e)}}onError(r){j("socket.error: %o",r);const e=new N(-1,r.message);this.emit("ConnectionError",e),this.internalListeners.emit("ConnectionError",e)}onClose(r){j("socket.close: %s (%d)",r.reason,r.code);const e=new N(r.code,r.reason);this.emit("ConnectionClosed",e),this.internalListeners.emit("ConnectionClosed",e),this.cleanup()}}V.requestCounter=1;typeof exports!="undefined"&&Object.defineProperty(exports,"__esModule",{value:!0});class Ie extends V{constructor(...r){super(...r);this.protocol="obswebsocket.json"}async encodeMessage(r){return JSON.stringify(r)}async decodeMessage(r){return JSON.parse(r)}}const Pe=z(" \u5730\u5740"),Re=A("br",null,null,-1),Oe=z(" \u7AEF\u53E3"),Se=A("br",null,null,-1),Ee=z(" \u5BC6\u7801"),Me=A("br",null,null,-1),He={style:{"user-select":"none"},for:"auto"},De=z(" \u81EA\u52A8\u8FDE\u63A5 "),$e={style:{"user-select":"none"},for:"partyLength"},ze=z(" \u4EC5\u5728\u5C0F\u961F\u4EBA\u6570\u57285~8\u4EBA\u65F6\u5F55\u5236 "),je=A("br",null,null,-1),Ne=A("br",null,null,-1),Ve=["disabled"],Te=["disabled"],Ge=le({setup(n){let r=!1;const e=fe({ip:"127.0.0.1",port:"4455",password:"Yim1psOoJJ8s96Lc",autoConnect:!1,partyLength:!0,connect:!1,status:"\u7A7A\u95F2"}),l={party:[]};v();const g=new Ie;g.on("ExitStarted",m),g.on("ConnectionClosed",m),g.on("ConnectionError",m),addOverlayListener("onLogEvent",d),addOverlayListener("onInCombatChangedEvent",y),addOverlayListener("PartyChanged",a),startOverlayEvents(),setTimeout(async()=>{e.autoConnect&&await c()},1e3);function v(){var t,s,C,w,_;const h=JSON.parse((t=localStorage.getItem("ObsData"))!=null?t:"{}");e.ip=(s=h==null?void 0:h.ip)!=null?s:e.ip,e.port=(C=h==null?void 0:h.port)!=null?C:e.port,e.password=(w=h==null?void 0:h.password)!=null?w:e.password,e.autoConnect=(_=h==null?void 0:h.autoConnect)!=null?_:e.autoConnect}function F(){localStorage.setItem("ObsData",JSON.stringify({ip:e.ip,port:e.port,password:e.password,autoConnect:e.autoConnect,partyLength:e.partyLength}))}function m(){e.status="closed",e.connect=!1}async function c(){try{const{obsWebSocketVersion:h,negotiatedRpcVersion:t}=await g.connect(`ws://127.0.0.1:${e.port}`,e.password,{rpcVersion:1});e.status=`\u6210\u529F ${h} (using RPC ${t})`,e.connect=!0}catch(h){e.status=`\u5931\u8D25 ${h.code} ${h.message}`,e.connect=!1}}async function u(){await c()}async function o(){await g.disconnect()}async function i(){e.partyLength&&l.party.length<=8&&l.party.length>=5&&await g.call("StartRecord")}async function f(){await g.call("StopRecord")}async function p(){await f(),await i()}function y(h){!r&&h.detail.inACTCombat&&p(),r&&!h.detail.inACTCombat&&f(),r=h.detail.inACTCombat}function d(h){for(const t of h.detail.logs)/^.{14} \w+ 00:(?:00b9|0139)::?(?:距离战斗开始还有|Battle commencing in |戦闘開始まで)\d+[^（(]+[（(]/.test(t)?p():(/^.{14} (?:Director |)21:.{8}:4000001[026]/.test(t)||/^.{14} ChatLog 00:0038::end$/.test(t))&&f()}function a(h){var t;l.party=(t=h==null?void 0:h.party)!=null?t:[]}return(h,t)=>(de(),he(ve,null,[A("form",null,[Pe,$(A("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>B(e).ip=s)},null,512),[[q,B(e).ip]]),Re,Oe,$(A("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>B(e).port=s)},null,512),[[q,B(e).port]]),Se,Ee,$(A("input",{type:"password","onUpdate:modelValue":t[2]||(t[2]=s=>B(e).password=s),autocomplete:"on"},null,512),[[q,B(e).password]]),Me,A("label",He,[$(A("input",{type:"checkbox",id:"auto","onUpdate:modelValue":t[3]||(t[3]=s=>B(e).autoConnect=s)},null,512),[[K,B(e).autoConnect]]),De]),A("label",$e,[$(A("input",{type:"checkbox",id:"partyLength","onUpdate:modelValue":t[4]||(t[4]=s=>B(e).partyLength=s)},null,512),[[K,B(e).partyLength]]),ze]),je,A("button",{onClick:F},"\u4FDD\u5B58\u8BBE\u7F6E")]),Ne,A("p",null,"\u8FDE\u63A5\u72B6\u6001\uFF1A"+pe(B(e).status),1),A("button",{disabled:B(e).connect,onClick:u},"\u8FDE\u63A5",8,Ve),A("button",{disabled:!B(e).connect,onClick:o},"\u65AD\u5F00",8,Te)],64))}});export{Ge as default};
