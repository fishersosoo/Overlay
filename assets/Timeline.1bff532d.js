import{d as k,m as O,r as y,o as u,c as m,w as M,v as z,u as c,F as $,n as P,t as C,q as J,f as Z,p as q,a as G,b as H}from"./vendor.3f586db1.js";import{S as _}from"./sweetalert2.6e640675.js";import"./hasOverlayPluginApi.ecf97ca4.js";import{u as R,T as U}from"./timeline.1c9fa3fb.js";import{_ as K}from"./index.28d3a419.js";import"./action.74adb01a.js";import"https://overlay.diemoe.net/common/common.min.js";const Q=f=>(q("data-v-04eab697"),f=f(),G(),f),W={id:"wrapper"},X=Q(()=>H("path",{d:"M943.321212 577.163636c12.412121 18.618182 31.030303 31.030303 55.854546 37.236364 6.206061 0 12.412121 6.206061 12.412121 6.206061 6.206061 6.206061 18.618182 18.618182 18.618182 31.030303v24.824242c-6.206061 24.824242-12.412121 43.442424-24.824243 62.060606l-6.20606 12.412121c-6.206061 12.412121-12.412121 18.618182-24.824243 24.824243-6.206061 6.206061-18.618182 6.206061-24.824242 6.20606-6.206061 0-12.412121 0-18.618182-6.20606-18.618182-6.206061-37.236364-6.206061-55.854546-6.206061h6.206061-12.412121c-18.618182 0-31.030303 6.206061-43.442424 12.412121 0 0-12.412121 6.206061-24.824243 18.618182-12.412121 12.412121-24.824242 37.236364-24.824242 62.060606 0 18.618182 0 37.236364 12.412121 62.060606 6.206061 12.412121 6.206061 31.030303-6.206061 43.442425-12.412121 12.412121-24.824242 18.618182-37.236363 24.824242-6.206061 6.206061-37.236364 18.618182-68.266667 24.824242 37.236364-6.206061 12.412121 0-12.412121 0h-6.206061c-6.206061 0-12.412121 0-18.618182-6.20606-6.206061-6.206061-12.412121-12.412121-12.412121-24.824243v6.206061c-12.412121-31.030303-31.030303-55.854545-55.854545-68.266667 0-6.206061-24.824242-12.412121-49.648485-12.412121s-49.648485 6.206061-68.266667 24.824243c-24.824242 18.618182-43.442424 43.442424-49.648485 74.472727 0-6.206061-6.206061 0-12.412121 0 0 0-12.412121 6.206061-18.618182 6.20606-12.412121 0-18.618182 0-37.236363-6.20606-12.412121-6.206061-24.824242-6.206061-37.236364-12.412121l-37.236364-18.618182c-12.412121-6.206061-18.618182-12.412121-24.824242-24.824243-6.206061-6.206061-6.206061-12.412121-6.206061-18.618181 0-6.206061 0-18.618182 6.206061-31.030304 6.206061-6.206061 12.412121-24.824242 12.412121-49.648484s-12.412121-43.442424-31.030303-62.060606c-12.412121-12.412121-24.824242-18.618182-43.442424-24.824243h-24.824242-6.206061c-12.412121 0-31.030303 6.206061-49.648485 6.206061h-12.412121c-6.206061 0-12.412121 0-18.618182-6.206061-6.206061 0-12.412121-12.412121-24.824242-18.618182-18.618182-31.030303-31.030303-68.266667-37.236364-105.50303v-6.206061c0-18.618182 12.412121-24.824242 24.824242-31.030303 24.824242-6.206061 43.442424-24.824242 62.060606-43.442424 18.618182-6.206061 24.824242-31.030303 24.824243-55.854545s-6.206061-49.648485-24.824243-68.266667C62.060606 415.806061 31.030303 397.187879 0 390.981818c18.618182 6.206061 12.412121 0 12.412121-6.20606-6.206061-6.206061-6.206061-18.618182-6.20606-24.824243 0-6.206061 0-18.618182 6.20606-31.030303 6.206061-24.824242 18.618182-49.648485 31.030303-68.266667-12.412121 24.824242-6.206061 12.412121 0 6.206061 0-12.412121 6.206061-18.618182 12.412121-24.824242 6.206061 0 6.206061-6.206061 12.412122-6.206061s12.412121 0 18.618181 6.206061c24.824242 6.206061 49.648485 12.412121 74.472728 6.20606 24.824242 0 43.442424-12.412121 62.060606-31.030303 12.412121-12.412121 18.618182-24.824242 18.618182-43.442424 6.206061 0 6.206061-12.412121 6.20606-24.824242v-18.618182-18.618182c0-18.618182-6.206061-43.442424-12.412121-62.060606 6.206061 31.030303 0 18.618182 0 6.20606v0c12.412121-6.206061 18.618182-12.412121 31.030303-18.618181l37.236364-18.618182c12.412121-6.206061 24.824242-6.206061 37.236363-12.412121 12.412121-6.206061 24.824242-6.206061 31.030303-6.206061 12.412121 0 18.618182 0 24.824243 12.412121 6.206061 6.206061 12.412121 18.618182 12.412121 31.030303 6.206061 12.412121 18.618182 24.824242 37.236364 43.442424s37.236364 24.824242 62.060606 24.824243 49.648485-6.206061 68.266666-18.618182c24.824242-24.824242 37.236364-43.442424 43.442425-68.266667 0-6.206061 6.206061-12.412121 12.412121-18.618181 6.206061 0 12.412121-6.206061 18.618182-6.206061 12.412121 0 18.618182 0 31.030303 6.206061 12.412121 0 24.824242 6.206061 37.236363 12.412121 12.412121 6.206061 24.824242 12.412121 31.030303 18.618182 12.412121 6.206061 18.618182 18.618182 24.824243 24.824242 0 6.206061 6.206061 6.206061 6.20606 12.412121v6.206061c0 6.206061-6.206061 18.618182-6.20606 24.824242 0 6.206061-6.206061 24.824242-6.206061 37.236364v18.618182c6.206061 24.824242 12.412121 43.442424 31.030303 62.060606 18.618182 18.618182 37.236364 24.824242 62.060606 31.030303 24.824242 0 49.648485 0 68.266667-12.412121 6.206061 0 12.412121-6.206061 18.618182-6.206061h6.20606c6.206061 0 18.618182 6.206061 24.824243 12.412121 12.412121 12.412121 18.618182 24.824242 31.030303 43.442424 6.206061 18.618182 12.412121 43.442424 18.618182 62.060607 0 12.412121 0 24.824242-6.206061 31.030303-6.206061 6.206061-12.412121 12.412121-24.824242 18.618181-24.824242 6.206061-49.648485 31.030303-62.060606 55.854546-6.206061 6.206061-12.412121 24.824242-12.412122 49.648485-6.206061 24.824242 0 49.648485 18.618182 68.266666zM682.666667 341.333333c-43.442424-43.442424-105.50303-68.266667-167.563637-68.266666-31.030303 0-62.060606 6.206061-93.090909 18.618181-43.442424 18.618182-80.678788 49.648485-105.50303 86.884849-6.206061-6.206061-24.824242 37.236364-37.236364 80.678788 0-18.618182-6.206061 12.412121-6.20606 49.648485 0 31.030303 6.206061 62.060606 18.618181 93.090909 12.412121 31.030303 31.030303 55.854545 49.648485 74.472727 18.618182 24.824242 49.648485 37.236364 74.472728 49.648485 31.030303 12.412121 62.060606 18.618182 93.090909 18.618182s62.060606-6.206061 93.090909-18.618182c43.442424-18.618182 80.678788-49.648485 105.50303-86.884849-6.206061 12.412121 12.412121-12.412121 24.824243-43.442424 12.412121-31.030303 18.618182-62.060606 18.618181-93.090909s-6.206061-62.060606-18.618181-93.090909C713.69697 372.363636 682.666667 335.127273 645.430303 310.30303l37.236364 31.030303z","p-id":"2216",fill:"#fff"},null,-1)),Y=[X],e2={key:0,class:"optionalTimelines"},t2=["onClick"],n2=k({setup(f){const n=R(),o=O({loadedTimeline:[],optionalTimeline:[]}),g=y(0),l=y(0-n.configValues.preBattle),h=y(0);let p,r=!0,I=300,a={zoneId:"0",job:"NONE"},T;B();function B(){var e;addOverlayListener("onLogEvent",x),addOverlayListener("onPlayerChangedEvent",A),addOverlayListener("ChangeZone",F),addOverlayListener("BroadcastMessage",V),addOverlayListener("onInCombatChangedEvent",L),startOverlayEvents(),n.loadTimelineSettings(),a.job=(e=localStorage.getItem("timelineLastJob"))!=null?e:"NONE"}function j(){const e=window.open(`${window.location.href}/settings`,"_blank","width=1200,height=800"),t=setInterval(function(){(e==null?void 0:e.closed)&&(clearInterval(t),n.loadTimelineSettings(),v(a))},500)}function v(e){b(),o.loadedTimeline.length=0,o.optionalTimeline.length=0;let t=n.getTimeline(e);t.length===1?w(t[0]):t.length>1&&(o.optionalTimeline=t)}function D(e){w(e)}function w(e){b(),r=!1,setTimeout(()=>{r=!0},1e3),e&&(e==null?void 0:e.timeline)&&(o.loadedTimeline=n.parseTimeline(e.timeline),o.loadedTimeline.sort((t,i)=>t.time-i.time),_.fire({position:"top-end",icon:"success",text:`\u52A0\u8F7D\u4E86${e.name}~`,showConfirmButton:!1,timer:1e3,backdrop:!1}),T=e)}function b(){clearInterval(Number(p)),g.value=0,l.value=0-n.configValues.preBattle,h.value=0}function S(e){g.value=new Date().getTime()+e*1e3,clearInterval(Number(p)),p=setInterval(()=>{l.value=(new Date().getTime()-g.value+h.value)/1e3;const t=o.loadedTimeline.find(i=>i.tts&&!i.alertAlready&&i.time-n.configValues.ttsAdvance<=l.value);t&&(t.alertAlready=!0,t.tts&&N(t.tts))},n.configValues.refreshRateMs)}function x(e){for(const t of e.detail.logs){let i=t.match(/^.{14} (\w+ |)00:(?:00b9|0139)::?(?:距离战斗开始还有|Battle commencing in |戦闘開始まで)(?<cd>\d+)[^（(]+[（(]/i);if(i)S(parseInt(i.groups.cd));else if(a.zoneId==="1009"&&/^.{14} (?:Director |)21:.{8}:8.{5}1A/.test(t))v(a);else if(/^.{14} (?:Director |)21:.{8}:4000001[026]/.test(t)||/^.{14} ChatLog 00:0038::end$/.test(t))b(),w(T);else{const d=o.loadedTimeline.find(s=>s.sync&&s.sync.test(t)&&l.value>=s.time-s.windowBefore&&l.value<=s.time+Number(s.windowAfter));d&&E(d.jump||d.time)}}}function E(e){h.value+=(e-l.value)*1e3}function A(e){a.job!==e.detail.job&&(a.job=e.detail.job,localStorage.setItem("timelineLastJob",e.detail.job))}function F(e){a.zoneId=String(e.zoneID),T={name:"",condition:{zoneId:"",job:"NONE"},timeline:"",codeFight:"",create:""},v(a)}function N(e){r&&(r=!1,callOverlayHandler({call:"cactbotSay",text:e}),setTimeout(()=>{r=!0},I))}function V(e){e.source==="soumuaTimelineSetting"&&e.msg.store&&_.fire({text:`\u63A5\u53D7\u5230${e.msg.store.allTimelines.length}\u4E2A\u65F6\u95F4\u8F74`,showDenyButton:!0,denyButtonText:"\u8986\u76D6",showConfirmButton:!0,confirmButtonText:"\u8FFD\u52A0",showCancelButton:!0,cancelButtonText:"\u653E\u5F03",backdrop:!1}).then(t=>{(t.isConfirmed||t.isDenied)&&(t.isDenied&&(n.allTimelines.length=0),n.allTimelines=e.msg.store.allTimelines,n.configValues=e.msg.store.configValues,n.showStyle=e.msg.store.showStyle,n.saveTimelineSettings(),_.fire("\u63A5\u53D7\u6210\u529F"),v(a))})}function L(e){e.detail.inGameCombat&&e.detail.inACTCombat&&S(0)}return(e,t)=>(u(),m("div",W,[M((u(),m("svg",{onClick:t[0]||(t[0]=i=>j()),t:"1652767124032",class:"icon",viewBox:"0 0 1030 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2215",width:"16",height:"16"},Y,512)),[[z,g.value===0]]),c(o).optionalTimeline.length&&l.value<=-c(n).configValues.preBattle?(u(),m("ul",e2,[(u(!0),m($,null,P(c(o).optionalTimeline,(i,d)=>(u(),m("li",{key:d,onClick:s=>D(i)},C(i.condition.job)+" - "+C(i.name),9,t2))),128))])):J("",!0),Z(U,{config:c(n).configValues,lines:c(o).loadedTimeline,runtime:l.value,"show-style":c(n).showStyle},null,8,["config","lines","runtime","show-style"])]))}});var d2=K(n2,[["__scopeId","data-v-04eab697"]]);export{d2 as default};
